<!DOCTYPE html>
<html>
<head>
    <title>系统主页</title>
    <meta charset= 'utf-8' />
    <script src="{{ url_for('static', filename = 'js/flexible.js') }}"></script>
    <script src="{{ url_for('static', filename = 'js/jquery.js') }}"></script>
    <script src="{{ url_for('static', filename = 'js/echarts.min.js') }}"></script>
    <link rel="stylesheet", href="{{ url_for('static', filename='css/style.css') }}" />
</head>
<body>
<header>
    <h1>客户数据分析系统</h1>
    <div class="showTime"></div>
    <script>
        var t = null;
        t = setTimeout(time, 1000);

        function time() {
            clearTimeout(t);
            dt = new Date();
            var y = dt.getFullYear();
            var mt = dt.getMonth() + 1;
            var day = dt.getDate();
            var h = dt.getHours();
            var m = dt.getMinutes();
            var s = dt.getSeconds();
            document.querySelector(".showTime").innerHTML = '当前时间：' + y + "年" + mt + "月" + day + "日-" + h + "时" + m + "分" + s + "秒";
            t = setTimeout(time, 1000);
        }
    </script>
</header>
<section>
    <div class="center">
        <div class="box">
            <div>
                <label class='btn import' for="import">上传文件</label>
            </div>
            <div>
                <label>选择：</label>
                <select class='filelist' style="width:60%">
                    {% for file in files %}
                        <option>{{ file }}</option>
                    {% endfor %}
                </select>
            </div>
            <input id='import' type="file" name="file" style="display:none" onchange="upload()"/>
        </div>
        <div class="box">
            <label class="btn show">数据查询</label>
        </div>
        <div class="box">
            <label class="btn analysis">数据分析</label>
        </div>
        <div class="box">
            <label class="btn result" onclick="window.location.href='/result'">结果展示</label>
        </div>
    </div>
    <script>
        function upload() {
            var files = $('#import').prop('files');
            console.log(files[0].name)
            var filedata = new FormData();
            filedata.append('file_data', files[0]);
            filedata.append('file_name', files[0].name)

            $.ajax({
                type: 'POST',
                url: "/upload",
                data: filedata,
                cache: false,
                processData: false,
                contentType: false,
                success: function (response) {
                    $('.filelist').append('<option>' + files[0].name + '</option>')
                    console.log(response)
                },
                error: function() {
                    console.log('fail');
                }
            });
        }
        $('.filelist').on('change', function() {
            filename = $('.filelist option:selected').text()
            console.log(filename)

            $.ajax({
                url: '/changeChosen',
                type: 'POST',
                data: {
                    'filename': filename
                }
            })
        })
    </script>
    {#    <script>#}
    {#        function upload(){#}
    {#            var files = $('#import').prop('files');#}
    {##}
    {#            console.log(file)#}
    {#            var reader = new FileReader();#}
    {##}
    {#            reader.addEventListener("load", function () {#}
    {##}
    {#                var text = String.fromCharCode.apply(null, new Uint8Array(reader.result));#}
    {##}
    {#                $.ajax({#}
    {#                    url: '/upload',#}
    {#                    method: 'POST',#}
    {#                    dataType: 'json',#}
    {#                    data: {#}
    {#                        'filename': file['name'],#}
    {#                        'filedata': text#}
    {#                    },#}
    {#                    success: function(response) {#}
    {#                        console.log(response)#}
    {#                    },#}
    {#                    error: function(response) {#}
    {#                        console.log('fail')#}
    {#                    }#}
    {#                })#}
    {#            }, false);#}
    {##}
    {#            if (file) {#}
    {#                reader.readAsArrayBuffer(file);#}
    {#            }#}
    {#        }#}
    {#    </script>#}
</section>
</body>
</html>